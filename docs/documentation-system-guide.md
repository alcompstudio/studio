# Руководство по системе автоматической документации проекта

## Обзор системы

Наш проект использует полуавтоматическую систему документации, которая:
1. Автоматически определяет ключевые моменты в разработке (чекпоинты)
2. Предлагает обновления документации
3. После утверждения, выполняет необходимые обновления

## Компоненты системы

### Чекпоинты и триггеры (`.ai/documentation-checkpoints.yaml`)

Этот файл определяет, когда система должна предлагать обновления документации:
- **Git-based**: основаны на коммитах и изменениях файлов
- **Code-based**: основаны на изменениях структуры кода
- **Manual**: запускаемые вручную

### Скрипты автоматизации (`scripts/docs/`)

- `checkpoint-detector.js`: Определяет, был ли пройден чекпоинт.
- `documentation-updater.js`: Выполняет обновление документации на основе сработавших чекпоинтов и подтверждения пользователя/ИИ.
- `git-progress-generator.js`: Генерирует журнал прогресса из Git-коммитов.
- `code-structure-extractor.js`: Анализирует структуру кода, извлекает информацию о компонентах, генерирует метаданные и Markdown-документацию.
- `docs-validator.js`: Проверяет целостность, актуальность и наличие плейсхолдеров в документации.

### Интеграция с VS Code (`.vscode/`)

Система интегрирована с VS Code через задачи и настройки:
- **`tasks.json`**: Задачи для ручного запуска проверки чекпоинтов, обновления документации, генерации отчетов, извлечения структуры кода и валидации.
- **`settings.json`**: Настройки для ИИ-агентов (пути к базе знаний, приоритетные файлы), профили терминала.
- **`.vscode/documentation-updater.js`**: Скрипт-пример для более глубокой интеграции с UI VS Code (требует создания полноценного расширения для полной функциональности).

### Интеграция с Git (`.husky/`)

Система использует Git хуки для автоматических проверок:
- **`pre-commit`**: Запускает `lint-staged`, который может вызывать `docs-validator.js` и `checkpoint-detector.js --interactive` для измененных файлов.
- **`post-commit`**: Запускает `checkpoint-detector.js --git-hook` для определения необходимости обновления документации после коммита.

### CI/CD (`.github/workflows/docs.yml`)

- Автоматическая валидация документации при push и pull request.
- Автоматическая генерация еженедельного отчета о прогрессе (или по другому расписанию/триггеру).

### Руководства и конфигурации для ИИ (`.ai/`)

- `documentation-checkpoints.yaml`: Конфигурация чекпоинтов.
- `agent-guide.md`: Общее руководство для ИИ-агентов по работе с проектом.
- `documentation-prompts.md`: Специализированные инструкции для ИИ по работе с системой документации.
- `pending-documentation-updates.md`: Файл, генерируемый `documentation-updater.js`, с предложениями по обновлению для ИИ-агента.
- `config.yaml`: Общие настройки для ИИ.

## Как это работает (Идеальный сценарий)

1.  **Разработка**: Разработчик или ИИ-агент вносит изменения в код.
2.  **Pre-commit Hook**: Перед коммитом `lint-staged` запускает `docs-validator.js` для измененных файлов документации и `checkpoint-detector.js --interactive` для измененных файлов кода. Если есть проблемы, коммит может быть прерван или выведено предупреждение.
3.  **Коммит**: Изменения попадают в репозиторий.
4.  **Post-commit Hook**: `checkpoint-detector.js --git-hook` анализирует коммит(ы). Если срабатывает чекпоинт, `documentation-updater.js` (через `checkpoint-detector.js` или отдельный вызов) создает/обновляет `.ai/pending-documentation-updates.md`.
5.  **Уведомление/Действие ИИ-агента**:
    *   ИИ-агент (или VS Code "расширение" `.vscode/documentation-updater.js`) периодически проверяет `.ai/pending-documentation-updates.md`.
    *   При наличии предложений, ИИ-агент информирует пользователя, используя промпты из `.ai/documentation-prompts.md`.
6.  **Подтверждение пользователя**: Пользователь просматривает предложенные изменения и одобряет их (полностью или частично).
7.  **Выполнение обновления**: ИИ-агент (или пользователь через VS Code Task) запускает `documentation-updater.js executeDocumentationUpdates` с одобренными действиями.
8.  **Обновление метки времени**: `documentation-updater.js` обновляет `.ai/.last_doc_update_timestamp` после успешного выполнения всех одобренных действий.
9.  **CI/CD**: При пуше в репозиторий GitHub Actions запускает `docs-validator.js`. Периодически запускается `git-progress-generator.js`.

## Как использовать

### Для ИИ-агентов

ИИ-агенты должны:
1.  Следовать инструкциям в `.ai/documentation-prompts.md` и `.ai/agent-guide.md`.
2.  Регулярно проверять (или быть уведомленными о) файле `.ai/pending-documentation-updates.md`.
3.  Предлагать пользователю обновить документацию при наличии предложений и выполнять одобренные действия.
4.  Проактивно документировать важные изменения в коде (JSDoc/TSDoc) и предлагать создание/обновление `.md` файлов, `.metadata.json`, ADR.

### Для разработчиков (людей)

Разработчики могут:
1.  Полагаться на pre-commit и post-commit хуки для базовых проверок и обнаружения чекпоинтов.
2.  Вручную запустить проверку чекпоинтов через VS Code Task: `"Docs: Check for Pending Updates"`.
3.  Вручную запустить полное обновление документации через VS Code Task: `"Docs: Update Documentation Manually"`.
4.  Использовать другие задачи VS Code для запуска отдельных скриптов (`git-progress-generator.js`, `code-structure-extractor.js`, `docs-validator.js`).
5.  Настраивать чекпоинты в файле `.ai/documentation-checkpoints.yaml`.

## План внедрения (кратко)

1.  **Фаза 1: Базовая настройка (Завершена)**
    *   Установка зависимостей.
    *   Настройка Git хуков (`pre-commit`, `post-commit`).
    *   Создание базовой структуры документации и скриптов.
    *   Заполнение первоначальной документации.

2.  **Фаза 2: Расширение и детализация скриптов (В процессе)**
    *   Доработка `checkpoint-detector.js` (особенно `time-based` и `code-based` триггеры, функция `analyzeCodeChanges`).
    *   Доработка `code-structure-extractor.js` (более точный анализ пропсов, типов, JSDoc, генерация Mermaid).
    *   Доработка `docs-validator.js` (проверка метаданных, соответствия кода и доков, ADR).
    *   Обеспечение корректного экспорта/импорта функций между скриптами.
    *   Тщательное тестирование скриптов на реальных изменениях.

3.  **Фаза 3: Интеграция с ИИ-агентами и VS Code**
    *   Доработка `.vscode/documentation-updater.js` (в идеале - создание полноценного расширения VS Code).
    *   Обучение ИИ-агентов работе с системой (использование промптов, реакция на `.ai/pending-documentation-updates.md`).
    *   Интеграция с рабочими процессами ИИ.
   
4.  **Фаза 4: Мониторинг и улучшение**
    *   Сбор обратной связи от пользователей и ИИ-агентов.
    *   Доработка и оптимизация системы на основе опыта использования.
    *   Регулярное обновление руководств.
