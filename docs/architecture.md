# Архитектура Проекта "NextN Studio"

## 1. Общая архитектура проекта

Проект "NextN Studio" представляет собой монорепозиторий, построенный на базе фреймворка **Next.js (v15)**. Это обеспечивает гибкость в рендеринге страниц (SSR, SSG, ISR) и удобное создание бэкенд API через **API Routes**. Архитектура ориентирована на модульность и четкое разделение ответственности между слоями.

**Основные слои:**

-   **Клиентский слой (Frontend):** Реализован с использованием **React (v18)**, **TypeScript** и стилизован с помощью **Tailwind CSS**. Пользовательский интерфейс состоит из страниц (в `src/app/`) и переиспользуемых компонентов (в `src/components/`). Управление состоянием асинхронных операций и кэширование данных осуществляется с помощью **React Query (TanStack Query)**. Для работы с формами используется **React Hook Form** и **Zod** для валидации.
-   **Серверный слой (Backend/API):** Реализован с помощью API маршрутов Next.js (`src/app/api/`) на **Node.js** и **TypeScript**. Этот слой обрабатывает клиентские запросы, реализует бизнес-логику, взаимодействует с базой данных и интегрируется с внешними и внутренними сервисами, включая ИИ-функции на базе **Genkit AI**.
-   **Слой данных (Database):** В качестве основной системы управления базами данных используется **PostgreSQL**. Взаимодействие с БД осуществляется через ORM **Sequelize (v6)**. Модели данных определены в `src/lib/models/`, а SQL-миграции находятся в `src/migrations/`.
-   **Сервисный слой (Services):** Бизнес-логика, не привязанная напрямую к обработке HTTP-запросов или UI, может быть вынесена в отдельные сервисные модули (например, `src/services/currency-converter.ts`).
-   **Интеграционный слой (AI):** Модули для интеграции с ИИ-агентами и сервисами (например, Google AI через Genkit) расположены в `src/ai/`. Используется фреймворк **Genkit AI** для построения и развертывания ИИ-потоков.

```mermaid
graph TD
    subgraph "Клиент (Браузер)"
        A[UI: React, Next.js Pages, TailwindCSS <br> (src/app, src/components)] --> B{API Клиент <br> (fetch, React Query)}
    end

    subgraph "Сервер (Next.js, Node.js)"
        B --> C[API Маршруты <br> (src/app/api/)]
        C --> D{Сервисный слой <br> (src/services/)}
        D --> E[Модели Sequelize <br> (src/lib/models/)]
        E --> F[PostgreSQL (через Sequelize)]
        C --> G[Genkit AI Flows <br> (src/ai/)]
        G -- Google AI, etc. --> H((Внешние ИИ Сервисы))
        C -- Firebase SDK? --> I((Firebase Services))
    end

    F -.-> J[SQL Миграции <br> (src/migrations/)]
    
    style A fill:#e6f2ff,stroke:#333,stroke-width:2px
    style C fill:#d4f8e8,stroke:#333,stroke-width:2px
    style F fill:#ffe0b3,stroke:#333,stroke-width:2px
    style G fill:#f5ccff,stroke:#333,stroke-width:2px
    style I fill:#fff0b3,stroke:#333,stroke-width:2px
```

## 2. Основные компоненты и их взаимодействие

На основе структуры проекта можно выделить следующие ключевые компоненты:

-   **`src/app/(app)`**: Основное приложение с различными разделами:
    -   `admin-dashboard/`: Панель администратора.
    -   `dashboard/`: Пользовательская панель.
    -   `finance/`, `finance-admin/`: Модули, связанные с финансами.
    -   `find-orders/`: Поиск заказов.
    -   `my-bids/`: Заявки пользователя.
    -   `my-tasks/`: Задачи пользователя.
    -   `orders/`: Управление заказами (просмотр, создание, редактирование).
    -   `projects/`: Управление проектами (просмотр, создание, редактирование).
    -   `settings/`: Настройки пользователя.
    -   `users/`: Управление пользователями (вероятно, для администратора).
-   **`src/app/api`**: Бэкенд API:
    -   `auth/`: Аутентификация (логин, регистрация).
    -   `customers/`: API для управления клиентами.
    -   `orders/`: API для управления заказами.
    -   `projects/`: API для управления проектами.
-   **`src/components`**: Переиспользуемые UI компоненты:
    -   `auth/`: Компоненты для форм аутентификации.
    -   `layout/`: Компоненты макета страницы (header, sidebar и т.д.).
    -   `orders/`, `projects/`: Компоненты, специфичные для заказов и проектов.
    -   `ui/`: Базовые UI элементы (кнопки, инпуты, карточки и т.д.), вероятно, на основе shadcn/ui или подобной библиотеки.
-   **`src/lib`**: Вспомогательные модули:
    -   `db.ts`: Настройка и экспорт экземпляра Sequelize и моделей базы данных.
    -   `migrate.ts`: (Если существует) Скрипт для выполнения миграций. Миграции также могут управляться через `sequelize-cli`.
    -   `types.ts`: Глобальные определения типов TypeScript для проекта.
    -   `utils.ts`: Общие утилиты.
    -   `models/`: Определения моделей данных (User, Customer, Project, Order и т.д.).
-   **`src/services`**: Сервисы с бизнес-логикой (например, `currency-converter.ts`).
-   **`src/hooks`**: Пользовательские React хуки (например, `use-mobile.tsx`, `use-toast.ts`).
-   **`src/ai`**: Компоненты для интеграции с ИИ.

**Взаимодействие:**

1.  Пользователь взаимодействует с UI (страницы в `src/app/(app)` и компоненты в `src/components`).
2.  Действия пользователя (например, отправка формы) инициируют запросы к API маршрутам (`src/app/api`).
3.  API маршруты обрабатывают запросы, используя сервисы (`src/services`) и модели данных (`src/lib/models`) для взаимодействия с базой данных (`src/lib/db.ts`).
4.  Компоненты ИИ (`src/ai`) могут взаимодействовать как с клиентской, так и с серверной частью для предоставления своих функций.

## 3. Потоки данных

(Детальное описание потоков данных для ключевых операций, например, создание заказа, аутентификация пользователя.)

**Пример: Поток создания нового заказа**

1.  Пользователь открывает страницу ` /orders/new`.
2.  Заполняет форму (компонент из `src/components/orders/` или общая форма из `src/components/ui/form.tsx`).
3.  При отправке формы, клиентская часть отправляет POST-запрос на ` /api/orders`.
4.  API маршрут `src/app/api/orders/route.ts` принимает данные.
5.  Происходит валидация данных.
6.  Используется модель `Order` (`src/lib/models/Order.ts`) для создания новой записи в базе данных.
7.  Возвращается ответ клиенту об успехе или ошибке.

## 4. Принципы проектирования

-   **Компонентный подход:** Использование React компонентов для построения UI.
-   **Разделение ответственности (SoC):** Логика UI, бизнес-логика и доступ к данным разделены по разным модулям.
-   **Типизация:** Использование TypeScript для статической типизации и повышения надежности кода.
-   **Маршрутизация на основе файловой системы:** Характерно для Next.js.
-   **API First (предположительно):** Наличие выделенных API маршрутов для взаимодействия фронтенда и бэкенда.
-   **Использование утилитарных CSS классов (Tailwind CSS):** Для быстрой и гибкой стилизации.

## 5. Внешние зависимости

-   **Next.js:** Основной фреймворк.
-   **React:** Библиотека для построения UI.
-   **TypeScript:** Язык программирования.
-   **Tailwind CSS:** CSS фреймворк.
-   **PostgreSQL:** Реляционная система управления базами данных.
-   **Sequelize (v6):** ORM для Node.js, используемая для взаимодействия с PostgreSQL.
-   **pg (драйвер):** Node.js драйвер для PostgreSQL.
-   **React Hook Form & Zod:** Для управления формами и их валидации.
-   **React Query (TanStack Query):** Для управления состоянием сервера, кэширования и синхронизации данных.
-   **Radix UI & Lucide Icons:** Библиотеки для создания доступных и стильных UI компонентов.
-   **Recharts:** Библиотека для создания диаграмм.
-   **Genkit AI & @genkit-ai/googleai:** Фреймворк и плагин для интеграции с ИИ-сервисами.
-   **bcrypt:** Для хеширования паролей.
-   **date-fns:** Библиотека для работы с датами.
-   **clsx, tailwind-merge, tailwindcss-animate:** Утилиты для работы с Tailwind CSS.
